"use strict";var e=require("elliptic");var t=require("hash.js");var a=require("chai");require("bitcoin-computer-bitcore");var d=require("dotenv");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=c(t);c(d).default.config();const{PORT:o="3000",ZMQ_URL:s="tcp://litecoind:28332",CHAIN:i="LTC",NETWORK:n="regtest",BCN_ENV:b="dev",BCN_URL:f="http://127.0.0.1:3000",DEBUG_MODE:l="1",POSTGRES_USER:h="bcn",POSTGRES_PASSWORD:u="bcn",POSTGRES_DB:p="bcn",POSTGRES_HOST:w="127.0.0.1",POSTGRES_PORT:y="5432",RPC_PROTOCOL:v="http",RPC_USER:x="bcn-admin",RPC_PASSWORD:P="kH4nU5Okm6-uyC0_mA5ztVNacJqZbYd_KGLl6mx722A=",RPC_HOST:S="litecoind",RPC_PORT:m="19332",SERVER_VERSION:R="0.1",DEFAULT_WALLET:g="defaultwallet"}=process.env;parseInt(o,10);var q=f;parseInt(l,10),parseInt(y,10),parseInt(m,10);const K=(e,t)=>{if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++){const d=e[a];const c=Object.keys(d);let r=!1;for(let e=0;e<t.length;e++){const a=t[e];const o=Object.keys(a);if(c.length===o.length&&c.every((e=>o.includes(e)))&&c.every((e=>d[e]===a[e]))){r=!0;break}}if(!r)return!1}return!0};describe("utils",(()=>{describe("auth utils",(()=>{const t=new e.ec("secp256k1").genKeyPair();const d=t.getPublic().encodeCompressed("hex");const c=r.default.sha256().update("message").digest("hex");const o=t.sign(c).toDER("hex");const s=Date.now();it("Should create Authentication header and parse it",(()=>{const e=((e,t=Date.now(),a)=>{if(!a){const d=r.default.sha256().update(q+t).digest("hex");a=e.sign(d).toDER("hex")}const d=[a,e.getPublic().encodeCompressed("hex"),t];return`Bearer ${Buffer.from(d.join(":")).toString("base64")}`})(t,s,o);const i=(e=>{const t=e.split(" ");if(2!==t.length||"Bearer"!==t[0])throw new Error("Authentication header is invalid.");const a=Buffer.from(t[1],"base64").toString().split(":");if(3!==a.length)throw new Error;return{signature:a[0],publicKey:a[1],timestamp:parseInt(a[2],10)}})(e);a.expect(i.signature).eq(o),a.expect(i.publicKey).eq(d),a.expect(i.timestamp).eq(s),a.expect(t.verify(c,o)).to.be.true}))})),describe("arraysEqual utils",(()=>{it("Should work with identical arrays",(()=>{a.expect(K([{a:20,b:"hello",c:"world"}],[{a:20,b:"hello",c:"world"}])).eq(!0)})),it("Should work with object with different key order",(()=>{a.expect(K([{a:20,c:"world",b:"hello"}],[{a:20,b:"hello",c:"world"}])).eq(!0)})),it("Should work with object with different key order, different values",(()=>{a.expect(K([{a:20,b:"hello",c:"world"}],[{a:8,c:"world",b:"hello"}])).eq(!1)})),it("Should work with different arrays in length",(()=>{a.expect(K([{a:20,c:"world",b:"hello"}],[{a:20,c:"world",b:"hello"},{a:20,c:"world",b:"hello"}])).eq(!1)})),it("Should work with object arrays containing different object types",(()=>{a.expect(K([{a:7,c:"bye",b:"bye"},{a:20,c:"world",b:"hello"}],[{a:20,c:"world",b:"hello"},{a:7,c:"bye",b:"bye"}])).eq(!0)})),it("Should work with same utxos set, different object ordering ",(()=>{const e=[{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:49.99976817,satoshis:4999976817,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"5c84c2b6b95a97eab570da1820e5f099f2216d980aaf7d9823f4082252206e7f",vout:5},{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:50,satoshis:5e9,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"ac676b8137bd66513d6dbcdd7ae8721d9c7d6fc4b75ce4e939ea7e20805ed0ac",vout:0},{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:25,satoshis:25e8,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"82dfd1af79519bad58f33608df7a01d3d2cced1b2f1864a7d91ca7b07289ad38",vout:0}];const t=[{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:25,satoshis:25e8,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"82dfd1af79519bad58f33608df7a01d3d2cced1b2f1864a7d91ca7b07289ad38",vout:0},{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:49.99976817,satoshis:4999976817,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"5c84c2b6b95a97eab570da1820e5f099f2216d980aaf7d9823f4082252206e7f",vout:5},{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:50,satoshis:5e9,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"ac676b8137bd66513d6dbcdd7ae8721d9c7d6fc4b75ce4e939ea7e20805ed0ac",vout:0}];a.expect(K(e,t)).eq(!0),a.expect(K(t,e)).eq(!0)}))}))}));
