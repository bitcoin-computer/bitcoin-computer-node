"use strict";var e=require("elliptic");var t=require("hash.js");require("bitcoind-rpc"),require("bitcoin-computer-bitcore");var r=require("dotenv");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=i(t);i(r).default.config();const{PORT:c=3e3,ZMQ_URL:o="tcp://litecoind:28332",CHAIN:s="LTC",NETWORK:a="regtest",BCN_ENV:u="dev",BCN_URL:d="http://127.0.0.1:3000",DEBUG_MODE:R=1,POSTGRES_USER:l="bcn",POSTGRES_PASSWORD:p="bcn",POSTGRES_DB:h="bcn",POSTGRES_HOST:S="127.0.0.1",POSTGRES_PORT:E=5432,RPC_PROTOCOL:f="http",RPC_USER:O="bcn-admin",RPC_PASSWORD:P="kH4nU5Okm6-uyC0_mA5ztVNacJqZbYd_KGLl6mx722A=",RPC_HOST:_="litecoind",RPC_PORT:b=19332,SERVER_VERSION:g=.1,DEFAULT_WALLET:T="defaultwallet"}=process.env;var m=d;describe("utils",(()=>{describe("auth utils",(()=>{const t=new e.ec("secp256k1").genKeyPair();const r=t.getPublic().encodeCompressed("hex");const i=n.default.sha256().update("message").digest("hex");const c=t.sign(i).toDER("hex");const o=Date.now();it("Should create Authentication header and parse it",(()=>{const e=((e,t=Date.now(),r)=>{if(!r){const i=n.default.sha256().update(m+t).digest("hex");r=e.sign(i).toDER("hex")}const i=[r,e.getPublic().encodeCompressed("hex"),t];return`Bearer ${Buffer.from(i.join(":")).toString("base64")}`})(t,o,c);const s=(e=>{const t=e.split(" ");if(2!==t.length||"Bearer"!==t[0])throw new Error("Authentication header is invalid.");const r=Buffer.from(t[1],"base64").toString().split(":");if(3!==r.length)throw new Error;return{signature:r[0],publicKey:r[1],timestamp:parseInt(r[2],10)}})(e);expect(s.signature).toBe(c),expect(s.publicKey).toBe(r),expect(s.timestamp).toBe(o),expect(t.verify(i,c)).toBeTruthy()}))}))}));
