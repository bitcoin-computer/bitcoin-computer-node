"use strict";var e=require("elliptic");var t=require("hash.js");require("bitcoin-computer-bitcore"),require("bitcoind-rpc");var a=require("dotenv");function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=d(t);d(a).default.config();const{PORT:o=3e3,ZMQ_URL:r="tcp://litecoind:28332",CHAIN:i="LTC",NETWORK:s="regtest",BCN_ENV:n="dev",BCN_URL:b="http://127.0.0.1:3000",DEBUG_MODE:f=1,POSTGRES_USER:l="bcn",POSTGRES_PASSWORD:h="bcn",POSTGRES_DB:u="bcn",POSTGRES_HOST:p="127.0.0.1",POSTGRES_PORT:w=5432,RPC_PROTOCOL:y="http",RPC_USER:v="bcn-admin",RPC_PASSWORD:x="kH4nU5Okm6-uyC0_mA5ztVNacJqZbYd_KGLl6mx722A=",RPC_HOST:P="litecoind",RPC_PORT:S=19332,SERVER_VERSION:m=.1,DEFAULT_WALLET:R="defaultwallet"}=process.env;var g=b;const K=(e,t)=>{if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++){const d=e[a];const c=Object.keys(d);let o=!1;for(let e=0;e<t.length;e++){const a=t[e];const r=Object.keys(a);if(c.length===r.length&&c.every((e=>r.includes(e)))&&c.every((e=>d[e]===a[e]))){o=!0;break}}if(!o)return!1}return!0};describe("utils",(()=>{describe("auth utils",(()=>{const t=new e.ec("secp256k1").genKeyPair();const a=t.getPublic().encodeCompressed("hex");const d=c.default.sha256().update("message").digest("hex");const o=t.sign(d).toDER("hex");const r=Date.now();it("Should create Authentication header and parse it",(()=>{const e=((e,t=Date.now(),a)=>{if(!a){const d=c.default.sha256().update(g+t).digest("hex");a=e.sign(d).toDER("hex")}const d=[a,e.getPublic().encodeCompressed("hex"),t];return`Bearer ${Buffer.from(d.join(":")).toString("base64")}`})(t,r,o);const i=(e=>{const t=e.split(" ");if(2!==t.length||"Bearer"!==t[0])throw new Error("Authentication header is invalid.");const a=Buffer.from(t[1],"base64").toString().split(":");if(3!==a.length)throw new Error;return{signature:a[0],publicKey:a[1],timestamp:parseInt(a[2],10)}})(e);expect(i.signature).toBe(o),expect(i.publicKey).toBe(a),expect(i.timestamp).toBe(r),expect(t.verify(d,o)).toBeTruthy()}))})),describe("arraysEqual utils",(()=>{it("Should work with identical arrays",(()=>{expect(K([{a:20,b:"hello",c:"world"}],[{a:20,b:"hello",c:"world"}])).toBe(!0)})),it("Should work with object with different key order",(()=>{expect(K([{a:20,c:"world",b:"hello"}],[{a:20,b:"hello",c:"world"}])).toBe(!0)})),it("Should work with object with different key order, different values",(()=>{expect(K([{a:20,b:"hello",c:"world"}],[{a:8,c:"world",b:"hello"}])).toBe(!1)})),it("Should work with different arrays in length",(()=>{expect(K([{a:20,c:"world",b:"hello"}],[{a:20,c:"world",b:"hello"},{a:20,c:"world",b:"hello"}])).toBe(!1)})),it("Should work with object arrays containing different object types",(()=>{expect(K([{a:7,c:"bye",b:"bye"},{a:20,c:"world",b:"hello"}],[{a:20,c:"world",b:"hello"},{a:7,c:"bye",b:"bye"}])).toBe(!0)})),it("Should work with same utxos set, different object ordering ",(()=>{const e=[{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:49.99976817,satoshis:4999976817,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"5c84c2b6b95a97eab570da1820e5f099f2216d980aaf7d9823f4082252206e7f",vout:5},{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:50,satoshis:5e9,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"ac676b8137bd66513d6dbcdd7ae8721d9c7d6fc4b75ce4e939ea7e20805ed0ac",vout:0},{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:25,satoshis:25e8,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"82dfd1af79519bad58f33608df7a01d3d2cced1b2f1864a7d91ca7b07289ad38",vout:0}];const t=[{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:25,satoshis:25e8,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"82dfd1af79519bad58f33608df7a01d3d2cced1b2f1864a7d91ca7b07289ad38",vout:0},{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:49.99976817,satoshis:4999976817,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"5c84c2b6b95a97eab570da1820e5f099f2216d980aaf7d9823f4082252206e7f",vout:5},{address:"mx4WdU51jPh6KKvT5Dq27wMJJUW81vbF7y",amount:50,satoshis:5e9,scriptPubKey:"76a914b579e625fdfdca267d3b57ccc130f501fa1a27d188ac",txid:"ac676b8137bd66513d6dbcdd7ae8721d9c7d6fc4b75ce4e939ea7e20805ed0ac",vout:0}];expect(K(e,t)).toBe(!0),expect(K(t,e)).toBe(!0)}))}))}));
